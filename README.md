# 항해 플러스 프론트엔드 4기 과제 10주차 <br/>: Chapter 4-2. 성능 최적화 (2)

[1. 개요](#1-개요)

[2. 프로젝트 배포](#2-프로젝트-배포)

[3. 초기 성능 측정](#3-초기-성능-측정)

[4. 성능 개선 방법 및 과정](#4-성능-개선-방법-및-과정)

[5. 성능 개선 결과 및 분석](#5-성능-개선-결과-및-분석)

## 1. 개요

- 지난 과제에서 인프라 구성 및 개선을 통해 실제로 인프라를 구축하고 배포를 해보며 인프라 레벨에서 웹 성능을 최적화하는 방법을 학습해보았습니다.
- 이번 과제에서는 프론트엔드 개발자가 주요 쓰는 기술 스택을 사용하여 코드 레벨에서 웹 성능을 최적화 하는 기법을 이해할 수 있습니다.
- 프론트엔드 성능 측정 도구를 통해 측정 항목을 알아보고, 측정 방법을 통해 코드 성능 개선 작업을 수행할 수 있습니다.
- 성능 개선 후 성능 보고서를 작성하여 개선된 결과를 수치화하여 분석 및 평가를 진행할 수 있습니다.
- 실무에서 CSS 또는 JavaScript를 최적화 하는 방법을 실제로 적용해 볼 수 있습니다.

## 2. 프로젝트 배포

![vercel 배포과정](https://github.com/user-attachments/assets/0b4393de-ba31-49c5-95a1-93f1acb6935d)

1. 로컬 환경에서 코드를 Github 저장소에 푸시합니다.
2. main 브랜치에 푸시되면, Github은 Vercel에 웹훅 알림을 보냅니다.
3. Vercel은 웹훅 알림을 감지해 main 브랜치에 최신 코드를 가져와 자동으로 빌드 및 배포 프로세스를 시작합니다.
4. Vercel은 해당 프로젝트의 설정에 맞는 의존성을 설치하고, 정적 파일을 생성합니다.
5. 빌드된 파일을 Vercel CDN 및 Edge Network에 배포하고, 프로젝트 배포 URL을 생성합니다.

🔗 링크: https://front-4th-chapter4-2-basic.vercel.app/

## 3. 초기 성능 측정

|측정 항목|lighthouse|core web vitals|
|------|---|---|
||![before-lighthouse](https://github.com/user-attachments/assets/886fed0d-002b-44aa-b198-ff4b6791e7f9)|![before-pageSpeed Insights](https://github.com/user-attachments/assets/9410a37b-00ad-48fa-bef6-11b363f27858)|
|성능 점수|🟧 60|🟧 67|
|FCP|🟧 2.4s|🟧 2.4s|
|LCP|🔺 4.9s|🔺 15.3s|
|TBT|🟢 20ms|🟢 150ms|
|CLS|🔺 0.42|🟢 0.018|
|Speed Index|🟢 2.4s|🟧 4.6s|

- FCP (First Contentful Paint)
  - 사용자가 페이지로 처음 이동한 시점부터 페이지 콘텐츠의 일부가 화면에 렌더링되는 시점까지의 시간을 측정
  - 목표: 1.8s
- LCP (Largest Contentful Paint)
  - 사용자가 페이지로 처음 이동한 시점을 기준으로 표시 영역에 표시되는 가장 큰 콘텐츠(이미지, 텍스트 블록 또는 동영상 등)의 렌더링 시간
  - 목표: 2.5s
- TBT (Total Blocking Time)
  - FCP 이후 입력 응답성을 방지하기에 충분한 시간 동안 기본 스레드가 차단되었던 총 지연 시간을 측정
  - 목표: 200ms
- CLS (Cumulative Layout Shift)
  - 페이지가 로드되는 동안 예기치 않은 레이아웃 변경에 대한 레이아웃 변경 점수 중 가장 큰 버스트를 측정하는 측정항목
  - 목표: 0.1 미만
- Speed Index
  - 페이지 로드 중에 콘텐츠가 시각적으로 표시되는 속도를 측정
  - 목표: 0.34s 미만
 
> 보시다시피 측정 도구에 따라 결과가 조금씩 다르지만, 전반적으로 **FCP와 LCP 개선이 작업의 주요 목표**가 될 것 같습니다. <br />
> FCP와 LCP를 개선하기 위해 사용하지 않는 CSS 삭제, 서버 응답 시간 단축, 리소스 로드 지연 제거 등의 방법으로 서비스 성능을 개선해나갈 예정입니다.

## 4. 성능 개선 방법 및 과정

### 1) 이미지 형식 변환 (jpg, png -> webp)
- 대용량 이미지를 한 번에 로딩하니 초기 페이지 로드 시간이 길어 사용자 경험이 떨어졌습니다.
- 이를 해결하기 위해 이미지 형식을 JPEG나 PNG 대신 압축 효율이 높은 Webp 또는 AVIF와 같은 최신 포맷으로 변환합니다.
- 이는 이미지 품질을 유지하면서도 파일 크기를 크게 줄여주어 페이지 로드 시간을 단축하고 사용자 경험을 개선할 수 있습니다.

### 2) 이미지 사이즈 최적화 (picture 태그)
- `<picture>` 요소를 사용하여 설정한 뷰포트에 맞는 이미지가 로드되도록 설정했습니다.
- `<picture>` 요소는 내부에서 WebP나 AVIF와 같은 고효율 포맷을 우선 설정하고, 브라우저가 지원하지 않을 경우 JPEG나 PNG와 같은 기본 포맷을 로드합니다.
```html
  <picture>
    <source
      width="576"
      height="576"
      media="(max-width: 575px)"
      srcset="images/Hero_Mobile.webp"
    />
    <source
      width="960"
      height="770"
      media="(min-width: 576px) and (max-width: 960px)"
      srcset="images/Hero_Tablet.webp"
    />
    <img width="1920" height="893" src="images/Hero_Desktop.webp" alt="Hero-image" />
  </picture>
```

### 3) 이미지 지연 로딩 처리 (lazy loading)
- `<img>` 요소에 `loading` 속성을 추가하여 이미지의 로딩을 사용자가 해당 이미지에 가까이 스크롤할 때까지 지연시키도록 합니다.
- 이로인해 필요한 경우에만 리소스가 로드되어 초기 페이지 로드 속도가 빨라지고 네트워크 사용량을 감소시킬 수 있습니다.
```javascript
const img = document.createElement('img');
img.loading = 'lazy';
```

### 4) 중요하지 않은 스크립트 지연 처리 (defer)
- 브라우저는 `defer` 속성이 있는 스크립트를 비동기적으로 다운로드를 합니다.
- 쿠키 동의에 대한 스크립트는 비교적 중요하지 않은 스크립트에 해당하기 때문에 `defer`속성을 통해 스크립트를 다운하는 도중에도 HTML 파싱이 멈추지 않도록 처리했습니다.

### 5) 이미지 태그에 `alt` 속성 추가
- `<img>` 태그에 이미지 대체 텍스트를 입력하는 alt 속성을 추가했습니다.
- 이는 검색 엔진 최적화(SEO)에 대한 가시성을 증가시켜 웹 접근성 향상에 도움이 됩니다.

### 6) 불필요한 css 제거
- 사용되지 않는 CSS는 브라우저의 렌더링 트리 생성 속도를 느리게 합니다.
- `hidden` 클래스는 사용되지 않는 클래스로 삭제해줍니다.

### 7) 로컬 폰트를 사용하여 폰트 최적화 (woff 형식)
- 로컬 폰트는 웹 페이지에 포함되어 있어서 웹 폰트보다 상대적으로 초기 로딩 속도가 빠릅니다.
- 외부 서버에서 폰트를 다운로드하는 네트워크 부하를 감소시킬 수 있습니다.
- 필요한 특정 폰트만 포함시켜 사용하면 효율적인 리소스 관리가 가능합니다.
- 특히, woff 파일 형식은 ttf 형식에 비해 더 높은 압축률을 제공하여 로딩 속도가 더욱 빨라집니다.

```css
@font-face {
  font-family: 'Heebo';
  src: url('fonts/Heebo-Medium.woff2') format('woff');
  font-display: swap;
  font-weight: 600;
  font-style: medium;
}
```

## 5. 성능 개선 결과 및 분석

|측정 항목|lighthouse|core web vitals|
|------|---|---|
||![after-lighthouse](https://github.com/user-attachments/assets/ca5a4d85-9ed3-4361-9cb8-83ae55a84a01)|![after-pageSpeed Insights](https://github.com/user-attachments/assets/3ebfe0ee-719f-429f-ae0d-b5b1ec5c59c0)|
|성능 점수|🟢 99|🟢 97|
|FCP|🟢 0.8s|🟢 0.8s|
|LCP|🟢 2s|🟢 2s|
|TBT|🟢 10ms|🟢 170ms|
|CLS|🟢 0|🟢 0.001|
|Speed Index|🟢 0.8s|🟢 1.4s|

- 성능점수가 60점대에서 90점대로 확연히 높아져 100에 가까운 점수로 크게 개선하는 성과를 이루었습니다.
- FCP는 2.4초에서 0.8초로 초기에 목표로 했던 1.8초 이하로 초기 로딩 속도가 크게 향상되었습니다.
- LCP는 기존에 매우 높은 수치로 절감이 반드시 필요했었는데 개선 결과 2초까지 단축되어 컨텐츠 렌더링 시간이 크게 감소하였고, 이는 사용자 이탈율을 막는 효과를 기대해볼 수 있습니다.
- 성능 개선 방법 중에서 특히 이미지 최적화와 폰트 최적화가 성능 개선에 큰 영향을 주었습니다.

> 측정 도구를 통해 개선 변화를 시각적으로 나타내고 정확하게 수치화하니 성능 개선 효과를 크게 느낄 수 있었습니다. <br />
> 백엔드 혹은 인프라 최적화만이 아닌 프론트엔드 측면에서도 웹 성능 최적화를 진행할 수 있고, 이는 큰 기대효과를 가져다 준다고 생각합니다. <br />
> 페이지 로딩 속도가 빨라지니 사용자 경험이 향상되고 네트워크 트래픽이 절약되어 자연스레 비즈니스에도 긍정적인 기여를 줄 수 있다는 점을 깨달았습니다. <br />
